"use strict";(self["webpackChunkbook"]=self["webpackChunkbook"]||[]).push([[850],{4850:function(e,o,r){r.r(o),r.d(o,{default:function(){return c}});r(4114);var s=r(6768);const t={class:"login-container"};function n(e,o,r,n,l,a){const u=(0,s.g2)("User"),i=(0,s.g2)("el-icon"),m=(0,s.g2)("el-input"),c=(0,s.g2)("el-form-item"),d=(0,s.g2)("Lock"),g=(0,s.g2)("el-button"),f=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)("div",t,[(0,s.bF)(f,{ref:"form",model:l.form,rules:l.rules,class:"login-page"},{default:(0,s.k6)(()=>[o[5]||(o[5]=(0,s.Lk)("h2",{class:"title",style:{"margin-bottom":"20px"}},"系统登陆",-1)),(0,s.bF)(c,{prop:"username"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{modelValue:l.form.username,"onUpdate:modelValue":o[0]||(o[0]=e=>l.form.username=e),clearable:""},{prefix:(0,s.k6)(()=>[(0,s.bF)(i,{class:"el-input__icon"},{default:(0,s.k6)(()=>[(0,s.bF)(u)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(c,{prop:"password"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{modelValue:l.form.password,"onUpdate:modelValue":o[1]||(o[1]=e=>l.form.password=e),clearable:"","show-password":""},{prefix:(0,s.k6)(()=>[(0,s.bF)(i,{class:"el-input__icon"},{default:(0,s.k6)(()=>[(0,s.bF)(d)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(c),(0,s.bF)(c,null,{default:(0,s.k6)(()=>[(0,s.bF)(g,{type:"primary",style:{width:"100%"},onClick:a.login},{default:(0,s.k6)(()=>[...o[3]||(o[3]=[(0,s.eW)("登 录",-1)])]),_:1},8,["onClick"])]),_:1}),(0,s.bF)(c,null,{default:(0,s.k6)(()=>[(0,s.bF)(g,{type:"text",onClick:o[2]||(o[2]=o=>e.$router.push("/register"))},{default:(0,s.k6)(()=>[...o[4]||(o[4]=[(0,s.eW)("前往注册 >> ",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])}r(3110);var l=r(5067),a=r(1219),u={name:"LoginView",components:{},data(){return{form:{},useMock:!1,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{login(){this.$refs["form"].validate(e=>{e&&l.A.post("/login",this.form).then(e=>{if(1===e.code||0===e.code){const r=e.data||{},s=r.token||r.jwt_token||e.token||e.jwt_token||("string"===typeof r?r:null);if(!s)return console.warn("No token found in response:",r),void a.nk.error("登录失败：未收到 token，后端可能未正确返回");try{sessionStorage.setItem("token",s),sessionStorage.setItem("jwt_token",s),localStorage.setItem("token",s),localStorage.setItem("jwt_token",s)}catch(o){console.error("Error storing token:",o)}const t=null!=r.userRole?Number(r.userRole):"admin"===r.roleName?1:r.role||0,n={id:r.id||r.userId||null,username:r.username||this.form.username,role:t};sessionStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("user",JSON.stringify(n)),n.username&&(sessionStorage.setItem("username",n.username),localStorage.setItem("username",n.username)),a.nk.success(e.msg||"登录成功"),console.log("登录成功，开始记录访问"),l.A.get("/visit").then(e=>{console.log("访问记录成功:",e)}).catch(e=>{console.warn("记录访问失败：",e)}).finally(()=>{console.log("准备跳转到仪表板"),this.$router.push("/dashboard")})}else a.nk.error(e.msg||"登录失败")}).catch(e=>{console.error("login error",e),a.nk.error("登录请求失败")})})}}},i=r(1241);const m=(0,i.A)(u,[["render",n],["__scopeId","data-v-1b849fa4"]]);var c=m}}]);
//# sourceMappingURL=850.cfa04915.js.map