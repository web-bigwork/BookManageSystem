"use strict";(self["webpackChunkbook"]=self["webpackChunkbook"]||[]).push([[704],{2704:function(e,r,o){o.r(r),o.d(r,{default:function(){return d}});o(4114);var s=o(6768);const t={class:"login-container"};function n(e,r,o,n,l,a){const u=(0,s.g2)("User"),i=(0,s.g2)("el-icon"),m=(0,s.g2)("el-input"),d=(0,s.g2)("el-form-item"),c=(0,s.g2)("Lock"),k=(0,s.g2)("el-button"),f=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)("div",t,[(0,s.bF)(f,{ref:"form",model:l.form,rules:l.rules,class:"login-page"},{default:(0,s.k6)(()=>[r[5]||(r[5]=(0,s.Lk)("h2",{class:"title",style:{"margin-bottom":"20px"}},"系统登陆",-1)),(0,s.bF)(d,{prop:"username"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{modelValue:l.form.username,"onUpdate:modelValue":r[0]||(r[0]=e=>l.form.username=e),clearable:""},{prefix:(0,s.k6)(()=>[(0,s.bF)(i,{class:"el-input__icon"},{default:(0,s.k6)(()=>[(0,s.bF)(u)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(d,{prop:"password"},{default:(0,s.k6)(()=>[(0,s.bF)(m,{modelValue:l.form.password,"onUpdate:modelValue":r[1]||(r[1]=e=>l.form.password=e),clearable:"","show-password":""},{prefix:(0,s.k6)(()=>[(0,s.bF)(i,{class:"el-input__icon"},{default:(0,s.k6)(()=>[(0,s.bF)(c)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,s.bF)(d),(0,s.bF)(d,null,{default:(0,s.k6)(()=>[(0,s.bF)(k,{type:"primary",style:{width:"100%"},onClick:a.login},{default:(0,s.k6)(()=>[...r[3]||(r[3]=[(0,s.eW)("登 录",-1)])]),_:1},8,["onClick"])]),_:1}),(0,s.bF)(d,null,{default:(0,s.k6)(()=>[(0,s.bF)(k,{type:"text",onClick:r[2]||(r[2]=r=>e.$router.push("/register"))},{default:(0,s.k6)(()=>[...r[4]||(r[4]=[(0,s.eW)("前往注册 >> ",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])}o(3110);var l=o(5067),a=o(1219),u={name:"LoginView",components:{},data(){return{form:{},useMock:!1,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},methods:{login(){this.$refs["form"].validate(e=>{e&&l.A.post("/login",this.form).then(e=>{if(1===e.code||0===e.code){const o=e.data||{},s=o.token||o.jwt_token||e.token||e.jwt_token||("string"===typeof o?o:null);if(!s)return console.warn("No token found in response:",o),void a.nk.error("登录失败：未收到 token，后端可能未正确返回");try{sessionStorage.setItem("token",s),sessionStorage.setItem("jwt_token",s),localStorage.setItem("token",s),localStorage.setItem("jwt_token",s)}catch(r){console.error("Error storing token:",r)}const t=null!=o.userRole?Number(o.userRole):"admin"===o.roleName?1:o.role||0,n={id:o.id||o.userId||null,username:o.username||this.form.username,role:t};sessionStorage.setItem("user",JSON.stringify(n)),localStorage.setItem("user",JSON.stringify(n)),n.username&&(sessionStorage.setItem("username",n.username),localStorage.setItem("username",n.username)),a.nk.success(e.msg||"登录成功"),this.$router.push("/dashboard")}else a.nk.error(e.msg||"登录失败")}).catch(e=>{console.error("login error",e),a.nk.error("登录请求失败")})})}}},i=o(1241);const m=(0,i.A)(u,[["render",n],["__scopeId","data-v-358d77a9"]]);var d=m}}]);
//# sourceMappingURL=704.9622460f.js.map