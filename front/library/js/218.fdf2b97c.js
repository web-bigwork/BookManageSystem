"use strict";(self["webpackChunkbook"]=self["webpackChunkbook"]||[]).push([[218],{2218:function(e,l,a){a.r(l),a.d(l,{default:function(){return h}});var t=a(6768),r=a(4232);const o={class:"home",style:{padding:"10px"}},s={style:{margin:"10px 0"}},n={style:{margin:"10px 0"}},i={key:0},d={class:"dialog-footer"};function u(e,l,a,u,c,b){const g=(0,t.g2)("search"),p=(0,t.g2)("el-icon"),k=(0,t.g2)("el-input"),h=(0,t.g2)("el-form-item"),m=(0,t.g2)("el-button"),f=(0,t.g2)("el-form"),F=(0,t.g2)("el-table-column"),_=(0,t.g2)("el-tag"),v=(0,t.g2)("el-popconfirm"),C=(0,t.g2)("el-table"),z=(0,t.g2)("el-pagination"),D=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.Lk)("div",s,[(0,t.bF)(f,{inline:"true",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{label:"用户编号"},{default:(0,t.k6)(()=>[(0,t.bF)(k,{modelValue:c.search1,"onUpdate:modelValue":l[0]||(l[0]=e=>c.search1=e),placeholder:"请输入用户编号",clearable:""},{prefix:(0,t.k6)(()=>[(0,t.bF)(p,{class:"el-input__icon"},{default:(0,t.k6)(()=>[(0,t.bF)(g)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(h,{label:"用户名"},{default:(0,t.k6)(()=>[(0,t.bF)(k,{modelValue:c.search2,"onUpdate:modelValue":l[1]||(l[1]=e=>c.search2=e),placeholder:"请输入用户名",clearable:""},{prefix:(0,t.k6)(()=>[(0,t.bF)(p,{class:"el-input__icon"},{default:(0,t.k6)(()=>[(0,t.bF)(g)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(h,null,{default:(0,t.k6)(()=>[(0,t.bF)(m,{type:"primary",style:{"margin-left":"1%"},onClick:b.load,size:"mini"},{default:(0,t.k6)(()=>[...l[5]||(l[5]=[(0,t.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1}),(0,t.bF)(h,null,{default:(0,t.k6)(()=>[(0,t.bF)(m,{size:"mini",type:"danger",onClick:b.clear},{default:(0,t.k6)(()=>[...l[6]||(l[6]=[(0,t.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),(0,t.bF)(C,{data:c.tableData,stripe:"",border:"true"},{default:(0,t.k6)(()=>[(0,t.bF)(F,{prop:"userId",label:"用户编号",sortable:""}),(0,t.bF)(F,{prop:"username",label:"用户名"}),(0,t.bF)(F,{prop:"phone",label:"联系电话"}),(0,t.bF)(F,{prop:"overdueBooksCount",label:"逾期书籍数量",sortable:""}),(0,t.bF)(F,{prop:"totalOverdueDays",label:"累计逾期天数",sortable:""}),(0,t.bF)(F,{label:"状态"},{default:(0,t.k6)(()=>[(0,t.bF)(_,{type:"danger"},{default:(0,t.k6)(()=>[...l[7]||(l[7]=[(0,t.eW)("黑名单",-1)])]),_:1})]),_:1}),(0,t.bF)(F,{label:"操作",width:"200px"},{default:(0,t.k6)(e=>[(0,t.bF)(m,{size:"mini",onClick:l=>b.viewDetails(e.row)},{default:(0,t.k6)(()=>[...l[8]||(l[8]=[(0,t.eW)("查看详情",-1)])]),_:1},8,["onClick"]),(0,t.bF)(v,{title:"确认移出黑名单?",onConfirm:l=>b.removeFromBlacklist(e.row)},{reference:(0,t.k6)(()=>[(0,t.bF)(m,{type:"warning",size:"mini"},{default:(0,t.k6)(()=>[...l[9]||(l[9]=[(0,t.eW)("移出黑名单",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"]),(0,t.Lk)("div",n,[(0,t.bF)(z,{currentPage:c.currentPage,"onUpdate:currentPage":l[2]||(l[2]=e=>c.currentPage=e),"page-sizes":[5,10,20],"page-size":c.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:c.total,onSizeChange:b.handleSizeChange,onCurrentChange:b.handleCurrentChange},null,8,["currentPage","page-size","total","onSizeChange","onCurrentChange"])]),(0,t.bF)(D,{modelValue:c.detailDialogVisible,"onUpdate:modelValue":l[4]||(l[4]=e=>c.detailDialogVisible=e),title:"逾期详情",width:"50%"},{footer:(0,t.k6)(()=>[(0,t.Lk)("span",d,[(0,t.bF)(m,{onClick:l[3]||(l[3]=e=>c.detailDialogVisible=!1)},{default:(0,t.k6)(()=>[...l[16]||(l[16]=[(0,t.eW)("关 闭",-1)])]),_:1})])]),default:(0,t.k6)(()=>[c.selectedUser?((0,t.uX)(),(0,t.CE)("div",i,[(0,t.Lk)("p",null,[l[10]||(l[10]=(0,t.Lk)("strong",null,"用户编号：",-1)),(0,t.eW)((0,r.v_)(c.selectedUser.userId),1)]),(0,t.Lk)("p",null,[l[11]||(l[11]=(0,t.Lk)("strong",null,"用户名：",-1)),(0,t.eW)((0,r.v_)(c.selectedUser.username),1)]),(0,t.Lk)("p",null,[l[12]||(l[12]=(0,t.Lk)("strong",null,"联系电话：",-1)),(0,t.eW)((0,r.v_)(c.selectedUser.phone),1)]),(0,t.Lk)("p",null,[l[13]||(l[13]=(0,t.Lk)("strong",null,"逾期书籍数量：",-1)),(0,t.eW)((0,r.v_)(c.selectedUser.overdueBooksCount),1)]),(0,t.Lk)("p",null,[l[14]||(l[14]=(0,t.Lk)("strong",null,"累计逾期天数：",-1)),(0,t.eW)((0,r.v_)(c.selectedUser.totalOverdueDays),1)]),l[15]||(l[15]=(0,t.Lk)("p",null,[(0,t.Lk)("strong",null,"逾期书籍详情：")],-1)),(0,t.bF)(C,{data:c.selectedUser.overdueDetails,size:"small",style:{"margin-top":"10px"}},{default:(0,t.k6)(()=>[(0,t.bF)(F,{prop:"bookName",label:"书籍名称"}),(0,t.bF)(F,{prop:"lendTime",label:"借出时间"}),(0,t.bF)(F,{prop:"dueTime",label:"应还时间"}),(0,t.bF)(F,{prop:"overdueDays",label:"逾期天数"})]),_:1},8,["data"])])):(0,t.Q3)("",!0)]),_:1},8,["modelValue"])])}var c=a(5067),b=a(1219),g={name:"BlacklistView",created(){this.load()},methods:{load(){c.A.get("/blacklist/users",{params:{page:this.currentPage,pageSize:this.pageSize,userId:this.search1||void 0,username:this.search2||void 0}}).then(e=>{if(console.log("黑名单数据:",e),1===e.code){const l=e.data||{};this.tableData=l.rows||l.records||[],this.total=l.total||this.tableData.length}else b.nk.error(e.msg||"加载黑名单失败"),this.tableData=[],this.total=0}).catch(e=>{console.error("加载黑名单失败:",e),b.nk.error("加载黑名单失败，请稍后重试"),this.tableData=[],this.total=0})},clear(){this.search1="",this.search2="",this.load()},viewDetails(e){c.A.get(`/blacklist/user/${e.userId}/details`).then(l=>{console.log("用户逾期详情:",l),1===l.code?(this.selectedUser={...e,overdueDetails:l.data||[]},this.detailDialogVisible=!0):b.nk.error(l.msg||"获取详情失败")}).catch(e=>{console.error("获取详情失败:",e),b.nk.error("获取详情失败，请稍后重试")})},removeFromBlacklist(e){c.A.post("/blacklist/remove",{userId:e.userId}).then(l=>{console.log("移出黑名单结果:",l),1===l.code?(b.nk.success(l.msg||`已将用户 ${e.username} 移出黑名单`),this.load()):b.nk.error(l.msg||"移出黑名单失败")}).catch(e=>{console.error("移出黑名单失败:",e),b.nk.error("移出黑名单失败，请稍后重试")})},handleSizeChange(e){this.pageSize=e,this.load()},handleCurrentChange(e){this.currentPage=e,this.load()}},data(){return{search1:"",search2:"",tableData:[],detailDialogVisible:!1,selectedUser:null,currentPage:1,pageSize:10,total:0}}},p=a(1241);const k=(0,p.A)(g,[["render",u]]);var h=k}}]);
//# sourceMappingURL=218.fdf2b97c.js.map