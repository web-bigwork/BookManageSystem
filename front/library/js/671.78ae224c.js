"use strict";(self["webpackChunkbook"]=self["webpackChunkbook"]||[]).push([[671],{5671:function(e,a,l){l.r(a),l.d(a,{default:function(){return b}});var t=l(6768);const s={class:"home",style:{padding:"10px"}},o={style:{margin:"10px 0"}},r={style:{margin:"10px 0"}},i={style:{margin:"10px 0"}},n={class:"dialog-footer"};function d(e,a,l,d,u,h){const c=(0,t.g2)("search"),m=(0,t.g2)("el-icon"),p=(0,t.g2)("el-input"),b=(0,t.g2)("el-form-item"),f=(0,t.g2)("el-button"),g=(0,t.g2)("el-form"),k=(0,t.g2)("el-popconfirm"),_=(0,t.g2)("el-table-column"),F=(0,t.g2)("el-tag"),y=(0,t.g2)("el-table"),V=(0,t.g2)("el-pagination"),w=(0,t.g2)("el-radio"),C=(0,t.g2)("el-dialog");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.Lk)("div",o,[(0,t.bF)(g,{inline:"true",size:"small"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"用户编号"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{modelValue:u.search1,"onUpdate:modelValue":a[0]||(a[0]=e=>u.search1=e),placeholder:"请输入用户编号",clearable:""},{prefix:(0,t.k6)(()=>[(0,t.bF)(m,{class:"el-input__icon"},{default:(0,t.k6)(()=>[(0,t.bF)(c)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"用户名"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{modelValue:u.search2,"onUpdate:modelValue":a[1]||(a[1]=e=>u.search2=e),placeholder:"请输入用户名",clearable:""},{prefix:(0,t.k6)(()=>[(0,t.bF)(m,{class:"el-input__icon"},{default:(0,t.k6)(()=>[(0,t.bF)(c)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"电话号码"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{modelValue:u.search3,"onUpdate:modelValue":a[2]||(a[2]=e=>u.search3=e),placeholder:"请输入电话号码",clearable:""},{prefix:(0,t.k6)(()=>[(0,t.bF)(m,{class:"el-input__icon"},{default:(0,t.k6)(()=>[(0,t.bF)(c)]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(b,null,{default:(0,t.k6)(()=>[(0,t.bF)(f,{type:"primary",style:{"margin-left":"1%"},onClick:h.load,size:"mini"},{default:(0,t.k6)(()=>[...a[12]||(a[12]=[(0,t.eW)("查询",-1)])]),_:1},8,["onClick"])]),_:1}),(0,t.bF)(b,null,{default:(0,t.k6)(()=>[(0,t.bF)(f,{size:"mini",type:"danger",onClick:h.clear},{default:(0,t.k6)(()=>[...a[13]||(a[13]=[(0,t.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1}),1==u.user.userRole?((0,t.uX)(),(0,t.Wv)(b,{key:0,style:{float:"right"}},{default:(0,t.k6)(()=>[(0,t.bF)(f,{type:"primary",size:"mini",onClick:h.add},{default:(0,t.k6)(()=>[...a[14]||(a[14]=[(0,t.eW)("添加用户",-1)])]),_:1},8,["onClick"])]),_:1})):(0,t.Q3)("",!0)]),_:1})]),(0,t.Lk)("div",r,[1==u.user.userRole||1==u.user.role?((0,t.uX)(),(0,t.Wv)(f,{key:0,type:"primary",size:"mini",onClick:h.add,style:{"margin-right":"10px"}},{default:(0,t.k6)(()=>[...a[15]||(a[15]=[(0,t.eW)(" 添加用户 ",-1)])]),_:1},8,["onClick"])):(0,t.Q3)("",!0),1==u.user.userRole?((0,t.uX)(),(0,t.Wv)(k,{key:1,title:"确认删除?",onConfirm:h.deleteBatch},{reference:(0,t.k6)(()=>[(0,t.bF)(f,{type:"danger",size:"mini"},{default:(0,t.k6)(()=>[...a[16]||(a[16]=[(0,t.eW)("批量删除",-1)])]),_:1})]),_:1},8,["onConfirm"])):(0,t.Q3)("",!0)]),(0,t.bF)(y,{data:u.tableData,stripe:"",border:"true",onSelectionChange:h.handleSelectionChange},{default:(0,t.k6)(()=>[1==u.user.userRole||1==u.user.role?((0,t.uX)(),(0,t.Wv)(_,{key:0,type:"selection",width:"55"})):(0,t.Q3)("",!0),(0,t.bF)(_,{prop:"id",label:"用户编号",sortable:""}),(0,t.bF)(_,{prop:"userName",label:"用户名"}),(0,t.bF)(_,{prop:"phone",label:"电话号码"}),(0,t.bF)(_,{label:"角色"},{default:(0,t.k6)(e=>[1==e.row.userRole?((0,t.uX)(),(0,t.Wv)(F,{key:0,type:"success"},{default:(0,t.k6)(()=>[...a[17]||(a[17]=[(0,t.eW)("管理员",-1)])]),_:1})):((0,t.uX)(),(0,t.Wv)(F,{key:1,type:"info"},{default:(0,t.k6)(()=>[...a[18]||(a[18]=[(0,t.eW)("用户",-1)])]),_:1}))]),_:1}),(0,t.bF)(_,{fixed:"right",label:"操作"},{default:(0,t.k6)(e=>[(0,t.bF)(f,{size:"mini",onClick:a=>h.handleEdit(e.row)},{default:(0,t.k6)(()=>[...a[19]||(a[19]=[(0,t.eW)("编辑",-1)])]),_:1},8,["onClick"]),(0,t.bF)(k,{title:"确认删除?",onConfirm:a=>h.handleDelete(e.row.id)},{reference:(0,t.k6)(()=>[(0,t.bF)(f,{type:"danger",size:"mini"},{default:(0,t.k6)(()=>[...a[20]||(a[20]=[(0,t.eW)("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data","onSelectionChange"]),(0,t.Lk)("div",i,[(0,t.bF)(V,{currentPage:u.currentPage,"onUpdate:currentPage":a[3]||(a[3]=e=>u.currentPage=e),"page-size":u.pageSize,layout:"total, prev, pager, next, jumper",total:u.total,onCurrentChange:h.handleCurrentChange},null,8,["currentPage","page-size","total","onCurrentChange"]),(0,t.bF)(C,{modelValue:u.dialogVisible,"onUpdate:modelValue":a[11]||(a[11]=e=>u.dialogVisible=e),title:"编辑用户信息",width:"30%"},{footer:(0,t.k6)(()=>[(0,t.Lk)("span",n,[(0,t.bF)(f,{onClick:a[10]||(a[10]=e=>u.dialogVisible=!1)},{default:(0,t.k6)(()=>[...a[23]||(a[23]=[(0,t.eW)("取 消",-1)])]),_:1}),(0,t.bF)(f,{type:"primary",onClick:h.save},{default:(0,t.k6)(()=>[...a[24]||(a[24]=[(0,t.eW)("确 定",-1)])]),_:1},8,["onClick"])])]),default:(0,t.k6)(()=>[(0,t.bF)(g,{model:u.form,"label-width":"120px"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"用户名"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{style:{width:"80%"},modelValue:u.form.userName,"onUpdate:modelValue":a[4]||(a[4]=e=>u.form.userName=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"密码"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{style:{width:"80%"},modelValue:u.form.password,"onUpdate:modelValue":a[5]||(a[5]=e=>u.form.password=e),"show-password":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"确认密码"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{style:{width:"80%"},modelValue:u.form.checkpassword,"onUpdate:modelValue":a[6]||(a[6]=e=>u.form.checkpassword=e),"show-password":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"电话号码"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{style:{width:"80%"},modelValue:u.form.phone,"onUpdate:modelValue":a[7]||(a[7]=e=>u.form.phone=e)},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"角色"},{default:(0,t.k6)(()=>[(0,t.Lk)("div",null,[(0,t.bF)(w,{modelValue:u.form.userRole,"onUpdate:modelValue":a[8]||(a[8]=e=>u.form.userRole=e),modelModifiers:{number:!0},label:1},{default:(0,t.k6)(()=>[...a[21]||(a[21]=[(0,t.eW)("管理员",-1)])]),_:1},8,["modelValue"]),(0,t.bF)(w,{modelValue:u.form.userRole,"onUpdate:modelValue":a[9]||(a[9]=e=>u.form.userRole=e),modelModifiers:{number:!0},label:0},{default:(0,t.k6)(()=>[...a[22]||(a[22]=[(0,t.eW)("用户",-1)])]),_:1},8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])])}l(8111),l(1701),l(3110),l(8335);var u=l(5067),h=l(1219),c={created(){this.load();let e=sessionStorage.getItem("user")||"{}";this.user=JSON.parse(e)},name:"UserView",methods:{handleSelectionChange(e){this.ids=e.map(e=>e.id)},deleteBatch(){this.ids.length?u.A.post("/user/deleteBatch",this.ids).then(e=>{"0"===e.code?(h.nk.success("批量删除成功"),this.load()):h.nk.error(e.msg)}):h.nk.warning("请选择数据！")},load(){if(this.search1){const e=Number(this.search1);if(!Number.isNaN(e)){const a=`/user/${e}`;return console.log("Requesting by id:",a),void u.A.get(a).then(e=>{1===e.code?(this.tableData=[e.data],this.total=1):(this.tableData=[],this.total=0,h.nk.warning(e.msg||"未找到用户"))}).catch(e=>{console.error("Error fetching by id",e,e?.response);const a=e?.response?.status;h.nk.error("查询用户失败"+(a?"（HTTP "+a+")":""))})}}if(this.search2){const e="/user/by-username";return console.log("Requesting by username:",e,this.search2),void u.A.get(e,{params:{username:this.search2}}).then(e=>{1===e.code&&e.data?(this.tableData=[e.data],this.total=1):(this.tableData=[],this.total=0,h.nk.warning(e.msg||"未找到用户"))}).catch(e=>{console.error("Error fetching by username",e,e?.response);const a=e?.response?.status;h.nk.error("查询用户失败"+(a?"（HTTP "+a+")":""))})}if(this.search3){const e="/user/by-phone";return console.log("Requesting by phone:",e,this.search3),void u.A.get(e,{params:{phone:this.search3}}).then(e=>{1===e.code&&e.data?(this.tableData=[e.data],this.total=1):(this.tableData=[],this.total=0,h.nk.warning(e.msg||"未找到用户"))}).catch(e=>{console.error("Error fetching by phone",e,e?.response);const a=e?.response?.status;h.nk.error("查询用户失败"+(a?"（HTTP "+a+")":""))})}u.A.get("/users",{params:{page:this.currentPage,pageSize:this.pageSize}}).then(e=>{console.log(e),this.tableData=e.data.rows||e.data.records||[],this.total=e.data.total||0}).catch(e=>{console.error(e),h.nk.error("获取用户列表失败")})},clear(){this.search1="",this.search2="",this.search3="",this.load()},handleDelete(e){u.A.get("/deleteById",{params:{id:e}}).then(e=>{console.log(e),1==e.code?h.nk.success("删除成功"):h.nk.error(e.msg),this.load()})},add(){this.dialogVisible=!0,this.form={userRole:0}},save(){if(this.form.id){const e={id:this.form.id,old_username:this.form.old_username||this.form.userName,username:this.form.userName,password:this.form.password||"",checkpassword:this.form.checkpassword||""};void 0!==this.form.userRole&&(e.userRole=this.form.userRole),u.A.post("/updateUser",e).then(e=>{console.log(e),1==e.code?(0,h.nk)({message:e.msg||"更新成功",type:"success"}):h.nk.error(e.msg),this.load(),this.dialogVisible=!1})}else{const e={username:this.form.userName,password:this.form.password,checkpassword:this.form.checkpassword,phone:this.form.phone,userRole:this.form.userRole};u.A.post("/addUser",e).then(e=>{console.log(e),1==e.code?h.nk.success(e.msg||"添加成功"):h.nk.error(e.msg),this.load(),this.dialogVisible=!1})}},handleEdit(e){this.form=JSON.parse(JSON.stringify(e)),this.form.old_username=e.userName||e.username,this.dialogVisible=!0},handleCurrentChange(e){this.currentPage=e,this.load()}},data(){return{form:{},dialogVisible:!1,search1:"",search2:"",search3:"",search4:"",total:10,currentPage:1,pageSize:5,tableData:[],user:{},ids:[],useMock:!1}}},m=l(1241);const p=(0,m.A)(c,[["render",d]]);var b=p}}]);
//# sourceMappingURL=671.78ae224c.js.map